# Math AI Tutor - TODO 清单

## 数据库和后端 API
- [x] 设计数据库表结构（problems 表：存储题目和答案图片 URL、步骤数据）
- [ ] 实现图片上传到 S3 的 tRPC 接口
- [x] 实现 LLM 视觉识别接口，从题目和答案图片中提取步骤
- [x] 实现 AI 提示接口（hint），支持"为什么"和"下一步"两种模式
- [x] 实现获取题目列表和详情的 tRPC 接口
- [x] 编写后端单元测试

## 前端页面和交互
- [x] 设计深色主题配青色强调色的全局样式（渐变背景、发光效果）
- [ ] 实现首页：上传题目和答案图片的表单
- [x] 实现步骤展示页面：可点击的步骤卡片列表
- [x] 实现步骤卡片的选中和高亮效果
- [x] 实现文本选择功能（捕获 selectedText）
- [x] 实现桌面端右侧 AI 提示面板
- [x] 实现移动端底部抽屉式 AI 提示面板
- [x] 实现 AI 提示的加载和显示
- [x] 优化响应式布局

## 测试和优化
- [ ] 测试图片上传和 S3 存储功能
- [ ] 测试 LLM 视觉识别的准确性
- [x] 测试 AI 提示的质量和简洁性
- [x] 测试移动端和桌面端的交互体验
- [x] 性能优化和错误处理

## 预置题目数据
- [x] 创建脚本将题目7和题目8预置到数据库
- [x] 上传题目和答案图片到 S3

## 修复问题
- [x] 修复题目和答案图片无法显示的问题

## 优化改进
- [x] 修复 AI 提示中数学公式的显示（使用 LaTeX 渲染）
- [x] 将完整答案图片移到页面最下方，与题目和步骤区分开

## 新功能
- [x] AI 提示语音朗读功能
- [x] 渐进式步骤显示（初次只显示第一步，点击显示下一步或查看全部）

## 已知条件功能
- [x] 实现后端 API 从题目图片中提取已知条件列表
- [x] 在数据库 schema 中添加 conditions 字段存储已知条件
- [x] 在题目详情页面显示已知条件列表
- [x] 实现点击条件获取 AI 解释的功能
- [ ] 在解题步骤中标注使用了哪些条件
- [x] 编写已知条件功能的单元测试

## 修复问题
- [x] 修复已知条件点击后 AI 提示面板不显示内容的问题（桌面端正常）
- [x] 修复移动端已知条件点击后 AI 提示抽屉不显示内容的问题

## 学习进度追踪功能
- [x] 设计 user_progress 表存储用户学习数据
- [x] 实现记录查看题目的 API
- [x] 实现记录获取提示的 API
- [x] 实现记录点击条件的 API
- [x] 实现获取学习统计数据的 API
- [x] 创建学习报告页面展示统计数据
- [x] 在题目详情页自动记录学习行为
- [x] 添加可视化图表展示学习趋势
- [x] 编写学习进度追踪功能的单元测试

## 管理员题目上传功能
- [x] 创建管理员专用上传页面（/admin/upload）
- [x] 实现图片上传到 S3 的功能
- [x] 实现 LLM 自动识别题目和答案图片提取步骤和已知条件
- [x] 添加题目标题和描述编辑功能
- [x] 实现题目预览和确认功能
- [x] 添加权限检查（只有管理员可以访问上传页面）
- [ ] 编写上传功能的单元测试
- [x] 在导航栏添加管理员上传入口（仅管理员可见）

## 权限系统优化
- [x] 修改 problem.list 为公开访问（所有用户可以查看所有题目）
- [x] 修改 problem.getById 为公开访问（所有用户可以查看题目详情）
- [x] 修改 problem.create 为管理员专用（只有管理员可以上传题目）

## Bug 修复
- [x] 修复点击步骤后 AI 提示不显示的问题（将 hint API 改为 publicProcedure）
- [x] 检查浏览器控制台错误日志
- [x] 验证 hint API 调用是否正常

## Bug 修复 - 步骤点击显示错误
- [ ] 修复点击步骤后右侧显示条件而不是步骤的问题
- [ ] 检查 ProblemDetail.tsx 中的状态管理逻辑
- [ ] 确保点击步骤时清除 selectedCondition 状态

## Bug 修复 - 状态切换问题
- [x] 修复点击步骤时没有清除 selectedCondition 状态的问题
- [x] 修复点击条件时没有清除 currentHint 状态的问题

## 题目文字识别功能
- [x] 在 problem 表添加 problemText 字段存储提取的文字
- [x] 实现图片 OCR 识别功能（提取中英文和数学公式）
- [x] 在上传题目时自动调用 OCR 识别
- [x] 修改题目详情页：先显示文字，再显示图片
- [x] 确保数学公式用 LaTeX 格式正确渲染
- [ ] 编写 OCR 功能的单元测试
